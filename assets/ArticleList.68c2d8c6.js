/* empty css                  *//* empty css                      *//* empty css                 *//* empty css               *//* empty css                  *//* empty css                  */import{t as e,N as a}from"./nopic.b9cd70dd.js";import"./el-form-item.c6f666bf.js";import{f as t,x as s,w as l,g as o,h as r,j as d,a3 as u,J as i,A as n,y as p,z as c,a4 as m,a5 as f,B as g,a6 as h,a7 as y,o as v,m as b,n as k,D as w,F as C,I as _,a8 as I,G as z,ac as A,H as j,t as x,c as V}from"./vendor.cc5c9397.js";const S={class:"type-list"},L={class:"seach-section"},$={class:"create-type"},D=j("添加文章"),M=j("删除选择"),U=j("查询"),E={class:"type-list-table"},N=["src"],q=j("编辑 "),B=j("启用 "),F=j("冻结 "),G=j("删除 "),H={class:"pagination-box"};var J=t({name:"ArticleList",setup(t){const J=s(),{proxy:R}=l(),T=R.$serverUrl;o([]);const K=r({title:"",typeId:"-1",status:"-1"}),O=o({}),P=r({total:0,pagerCount:5,pageSize:10,pageArray:[2,5,10,20,30,50,100,200],offset:0}),Q=o([]),W=e=>{P.offset=0,P.pageSize=e,te()},X=e=>{P.offset=(e-1)*P.pageSize,te()},Y=o([]),Z=o([]);d((()=>{ae(),le()}));const ee=u((()=>Q.value.length>0)),ae=()=>{P.total=0,P.offset=0,O.value=K,se(),te()},te=()=>{let a={offset:P.offset,count:P.pageSize};for(let e in K)("status"!=e&&"typeId"!=e||"-1"!=K[e])&&K[e]&&(a[e]=K[e]);R.$axios.get("/articleList",{params:a,headers:{token:document.cookie}}).then((a=>{if(1041==a.data.status)return J.push({name:"Login"});1160==a.data.status&&(a.data.data.forEach((a=>{a.createdAt=e.formatDate(a.createdAt,"yyyy-MM-dd hh:mm:ss"),a.updatedAt=e.formatDate(a.updatedAt,"yyyy-MM-dd hh:mm:ss")})),Y.value=a.data.data,se())})).catch((e=>{console.log("error",e)}))},se=()=>{let e={};for(let a in O.value)("status"!=a&&"typeId"!=a||"-1"!=O.value[a])&&O.value[a]&&(e[a]=O.value[a]);R.$axios.get("/articleCount",{params:e,headers:{token:document.cookie}}).then((e=>{if(1041==e.data.status)return J.push({name:"Login"});1170==e.data.status&&(P.total=e.data.data[0].count)})).catch((e=>{console.log("error",e)}))},le=()=>{R.$axios({method:"get",url:"/typeData",headers:{token:document.cookie}}).then((e=>{if(1041==e.data.status)return i({showClose:!0,message:e.data.msg,type:"error"}),J.push({name:"Login"});1140==e.data.status?Z.value=e.data.data:i({showClose:!0,message:e.data.msg,type:"error"})})).catch((e=>{console.log("error",e)}))},oe=e=>{R.$axios({method:"post",url:"/articleStatus",data:{typeId:e.typeId,artId:e.artId,status:0==e.status?1:0,type:"Article"},headers:{token:document.cookie}}).then((a=>{if(1041==a.data.status)return J.push({name:"Login"});1180==a.data.status&&1==a.data.data.result[0]?(i({message:a.data.msg,showClose:!0,type:"success"}),e.status=a.data.data.status):i({message:a.data.msg,type:"error",showClose:!0})})).catch((e=>{console.log("err ==> ",e)}))},re=e=>{Q.value=[],e.forEach((e=>{Q.value.push(e.artId)}))},de=e=>{R.$axios({method:"post",url:"/removeArticle",data:{artIds:e},headers:{token:document.cookie}}).then((e=>{if(1041==e.data.status)return J.push({name:"Login"});1210==e.data.status?(i({message:e.data.msg,showClose:!0,type:"success"}),Y.value=[],ae()):i({message:e.data.msg,type:"error",showClose:!0})})).catch((e=>{console.log("err ==> ",e)}))},ue=()=>{de(Q.value)},ie=()=>{J.push({name:"AddArticle"})};return(e,t)=>{const s=n,l=p,o=c,r=m,d=f,u=g,i=h,R=y;return v(),b("div",S,[k("div",L,[k("div",$,[w(s,{type:"primary",onClick:ie},{default:C((()=>[D])),_:1}),w(s,{type:"danger",disabled:!_(ee),onClick:ue},{default:C((()=>[M])),_:1},8,["disabled"])]),w(u,{inline:!0,model:K,class:"demo-form-inline"},{default:C((()=>[w(o,{label:"文章名称"},{default:C((()=>[w(l,{modelValue:K.title,"onUpdate:modelValue":t[0]||(t[0]=e=>K.title=e),placeholder:"输入文章名称"},null,8,["modelValue"])])),_:1}),w(o,{label:"文章类型"},{default:C((()=>[w(d,{modelValue:K.typeId,"onUpdate:modelValue":t[1]||(t[1]=e=>K.typeId=e),placeholder:"选择文章类型"},{default:C((()=>[w(r,{label:"选择文章类型",value:"-1"}),(v(!0),b(z,null,A(Z.value,(e=>(v(),V(r,{label:e.title,value:e.typeId,key:e.typeId},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),w(o,{label:"状态"},{default:C((()=>[w(d,{modelValue:K.status,"onUpdate:modelValue":t[2]||(t[2]=e=>K.status=e),placeholder:"选择状态"},{default:C((()=>[w(r,{label:"选择状态",value:"-1"}),w(r,{label:"正常",value:"0"}),w(r,{label:"冻结",value:"1"})])),_:1},8,["modelValue"])])),_:1}),w(o,null,{default:C((()=>[w(s,{type:"primary",onClick:te},{default:C((()=>[U])),_:1})])),_:1})])),_:1},8,["model"])]),k("div",E,[w(_(I),{ref:"multipleTableRef",data:Y.value,onSelectionChange:re},{default:C((()=>[w(i,{type:"selection",width:"55"}),w(i,{prop:"typeName",label:"文章类型",width:"120"}),w(i,{property:"title",label:"名称",width:"120"}),w(i,{property:"status",label:"状态",width:"120","show-overflow-tooltip":""},{default:C((e=>[j(x(0==e.row.status?"正常":"冻结"),1)])),_:1}),w(i,{label:"更新时间",width:"180"},{default:C((e=>[j(x(e.row.createdAt),1)])),_:1}),w(i,{label:"图片",width:"180"},{default:C((e=>[k("img",{src:""==e.row.img?_(a):_(T)+"/"+e.row.img},null,8,N)])),_:1}),w(i,{label:"操作"},{default:C((e=>[w(s,{size:"small",type:"default",plain:"",onClick:a=>{return t=e.row.artId,void J.push({name:"AddArticle",query:{artId:t}});var t}},{default:C((()=>[q])),_:2},1032,["onClick"]),1==e.row.status?(v(),V(s,{key:0,size:"small",type:"success",plain:"",onClick:a=>oe(e.row)},{default:C((()=>[B])),_:2},1032,["onClick"])):(v(),V(s,{key:1,size:"small",type:"warning",plain:"",onClick:a=>oe(e.row)},{default:C((()=>[F])),_:2},1032,["onClick"])),w(s,{size:"small",type:"danger",plain:"",onClick:a=>{return t=e.row.artId,void de([t]);var t}},{default:C((()=>[G])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"]),k("div",H,[w(R,{background:"","pager-count":P.pagerCount,"page-size":P.pageSize,"page-sizes":P.pageArray,layout:"total, sizes, prev, pager, next, jumper",total:P.total,onSizeChange:W,onCurrentChange:X},null,8,["pager-count","page-size","page-sizes","total"])])])])}}});export{J as default};
